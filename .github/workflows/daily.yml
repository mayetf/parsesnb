name: Generate SNB SARH JSON (daily)

on:
  schedule:
    # Tous les jours à 07:15 UTC = 08:15 à Zurich en hiver (CET),
    # et 09:15 à Zurich en été (CEST). Si tu veux une heure fixe Zurich toute l'année,
    # dis-moi l'heure et je te propose une stratégie.
    - cron: "15 7 * * *"
  workflow_dispatch:

permissions:
  contents: write

concurrency:
  group: snb-sarh-daily
  cancel-in-progress: false

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.11"

      - name: Run parser
        run: |
          python3 --version
          python3 script/snb_sarh_to_json.py

      - name: Commit & push result.json (if changed)
        run: |
          git config user.name "github-actions[bot]"
          git config user.email "github-actions[bot]@users.noreply.github.com"
          git add public/result.json
          git commit -m "Update SNB SARH result.json" || echo "No changes to commit"
          git push
